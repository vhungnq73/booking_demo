#!/bin/bash

echo "🔍 Checking staged Java files with PMD..."

# Get staged Java files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.java$')

if [[ -z "$STAGED_FILES" ]]; then
  echo "✅ No staged Java files. Skipping PMD."
  exit 0
fi

# Run PMD (this will scan the whole codebase, or you can optimize with excludes)
mvn clean pmd:check

# Check result
if [ $? -ne 0 ]; then
  echo "🚫 PMD violations found. Commit aborted."
  echo "👉 Please fix violations or suppress if intentional."
  exit 1
else
  echo "✅ PMD passed. Proceeding with commit."
  exit 0
fi
